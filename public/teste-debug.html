<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Busca de Endereços</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow p-6">
        <h1 class="text-2xl font-bold mb-4">Debug - Busca de Endereços</h1>
        
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Logradouro (com data-address-search)</label>
            <input type="text" id="logradouro" name="logradouro" 
                   data-address-search="true"
                   placeholder="Digite o nome da rua..." 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Teste Manual</label>
            <button id="test-button" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Testar Busca Manual
            </button>
        </div>
        
        <div id="debug-log" class="mt-4 p-3 bg-black text-green-400 rounded text-xs font-mono max-h-60 overflow-y-auto">
            <h3 class="text-white font-semibold mb-2">Log de Debug:</h3>
            <div id="log-content"></div>
        </div>
        
        <div id="status" class="mt-4 p-3 bg-gray-100 rounded">
            <h3 class="font-semibold mb-2">Status:</h3>
            <div id="status-content">Carregando...</div>
        </div>
    </div>

    <script>
        // Sistema de log personalizado
        const logContent = document.getElementById('log-content');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addLog(message, type = 'log') {
            const div = document.createElement('div');
            const time = new Date().toLocaleTimeString();
            div.className = type === 'error' ? 'text-red-400' : type === 'warn' ? 'text-yellow-400' : 'text-green-400';
            div.textContent = `[${time}] ${message}`;
            logContent.appendChild(div);
            logContent.scrollTop = logContent.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog(args.join(' '), 'warn');
        };
        
        window.addEventListener('error', function(e) {
            addLog(`ERRO JS: ${e.message} em ${e.filename}:${e.lineno}`, 'error');
        });
        
        console.log('Página carregada, iniciando debug...');
    </script>
    
    <script src="js/address-search.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded disparado');
            
            const statusContent = document.getElementById('status-content');
            const testButton = document.getElementById('test-button');
            const logradouroInput = document.getElementById('logradouro');
            
            function updateStatus() {
                const info = [];
                info.push(`AddressSearch class: ${typeof window.AddressSearch}`);
                info.push(`addressSearch instance: ${typeof window.addressSearch}`);
                
                if (window.addressSearch) {
                    info.push(`API Key: ${window.addressSearch.googleMapsApiKey ? 'Configurada' : 'Não configurada'}`);
                    info.push(`Uso mensal: ${window.addressSearch.monthlyUsage || 0}`);
                    info.push(`Limite mensal: ${window.addressSearch.monthlyLimit || 0}`);
                }
                
                statusContent.innerHTML = info.join('<br>');
            }
            
            // Atualizar status a cada segundo
            setInterval(updateStatus, 1000);
            updateStatus();
            
            // Teste manual
            testButton.addEventListener('click', function() {
                console.log('Teste manual iniciado');
                if (window.addressSearch) {
                    console.log('Chamando searchByAddress diretamente...');
                    window.addressSearch.searchByAddress('Rua Augusta', logradouroInput);
                } else {
                    console.error('addressSearch não está disponível');
                }
            });
            
            // Monitor do input
            logradouroInput.addEventListener('input', function() {
                console.log(`Input manual detectado: "${this.value}"`);
            });
            
            // Verificar se os event listeners foram configurados
            setTimeout(() => {
                console.log('Verificando configuração dos event listeners...');
                const addressFields = document.querySelectorAll('input[data-address-search="true"]');
                console.log(`Campos com data-address-search encontrados: ${addressFields.length}`);
                addressFields.forEach((field, index) => {
                    console.log(`Campo ${index + 1}: ${field.id || field.name || 'sem identificador'}`);
                });
            }, 2000);
        });
    </script>
</body>
</html>