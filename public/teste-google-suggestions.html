<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Sugestões Google Maps</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="js/address-search.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-6">
        <div class="mb-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Teste - Sugestões Google Maps</h1>
            <p class="text-gray-600">Debug das sugestões de endereços do Google Maps</p>
        </div>

        <!-- Formulário de Teste -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Formulário de Teste</h3>
            
            <form class="space-y-4">
                <!-- Logradouro -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Logradouro</label>
                    <input type="text" id="logradouro" name="logradouro" 
                           data-address-search="true"
                           placeholder="Digite o nome da rua..." 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-500 mt-1">Digite pelo menos 3 caracteres para buscar</p>
                </div>
                
                <!-- Número -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Número</label>
                    <input type="text" id="numero" name="numero" 
                           placeholder="123" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- Bairro -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Bairro</label>
                    <input type="text" id="bairro" name="bairro" 
                           placeholder="Nome do bairro" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- Cidade -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Cidade</label>
                    <input type="text" id="cidade" name="cidade" 
                           placeholder="Nome da cidade" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- Estado -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Estado</label>
                    <input type="text" id="estado" name="estado" 
                           placeholder="Estado" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- CEP -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">CEP</label>
                    <input type="text" id="cep" name="cep" 
                           placeholder="00000-000" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </form>
        </div>

        <!-- Debug Info -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
            <h4 class="text-lg font-semibold text-blue-900 mb-3">
                <i class="fas fa-bug mr-2"></i>
                Debug Info
            </h4>
            
            <div id="debug-info" class="text-sm text-blue-800">
                <p>Aguardando interação...</p>
            </div>
        </div>

        <!-- Logs -->
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
            <h4 class="text-lg font-semibold text-gray-900 mb-3">
                <i class="fas fa-list mr-2"></i>
                Logs de Debug
            </h4>
            
            <div id="debug-logs" class="text-sm text-gray-700 space-y-1 max-h-60 overflow-y-auto">
                <!-- Logs serão adicionados aqui -->
            </div>
            
            <button onclick="clearLogs()" class="mt-3 px-3 py-1 bg-gray-500 text-white rounded text-xs hover:bg-gray-600">
                Limpar Logs
            </button>
        </div>
    </div>

    <script>
        // Função para adicionar logs
        function addLog(message, type = 'info') {
            const logsDiv = document.getElementById('debug-logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            
            const colors = {
                info: 'text-blue-600',
                success: 'text-green-600',
                warning: 'text-yellow-600',
                error: 'text-red-600'
            };
            
            logEntry.className = colors[type] || colors.info;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        // Função para limpar logs
        function clearLogs() {
            document.getElementById('debug-logs').innerHTML = '';
        }

        // Interceptar console.log para mostrar na página
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'info');
        };

        const originalWarn = console.warn;
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog(args.join(' '), 'warning');
        };

        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };

        // Aguardar carregamento do sistema
        document.addEventListener('DOMContentLoaded', function() {
            addLog('DOM carregado', 'success');
            
            // Verificar se AddressSearch está disponível
            setTimeout(() => {
                if (typeof window.addressSearch !== 'undefined') {
                    addLog('AddressSearch carregado com sucesso', 'success');
                    
                    // Verificar configuração
                    window.addressSearch.getConfig().then(config => {
                        addLog(`Google Maps configurado: ${config.enabled ? 'Sim' : 'Não'}`, config.enabled ? 'success' : 'warning');
                        if (config.enabled) {
                            addLog(`Uso atual: ${config.usage_count}/${config.monthly_limit}`, 'info');
                        }
                        
                        document.getElementById('debug-info').innerHTML = `
                            <div class="space-y-1">
                                <p><strong>Sistema:</strong> ${window.addressSearch ? 'Carregado' : 'Não carregado'}</p>
                                <p><strong>Google Maps:</strong> ${config.enabled ? 'Configurado' : 'Não configurado'}</p>
                                <p><strong>API Key:</strong> ${config.api_key ? 'Presente' : 'Ausente'}</p>
                                <p><strong>Uso:</strong> ${config.usage_count}/${config.monthly_limit}</p>
                            </div>
                        `;
                    }).catch(error => {
                        addLog(`Erro ao verificar configuração: ${error.message}`, 'error');
                    });
                } else {
                    addLog('AddressSearch não foi carregado', 'error');
                    document.getElementById('debug-info').innerHTML = '<p class="text-red-600">Sistema não carregado</p>';
                }
            }, 1000);
            
            // Monitorar campo de logradouro
            const logradouroField = document.getElementById('logradouro');
            if (logradouroField) {
                logradouroField.addEventListener('input', function(e) {
                    addLog(`Input no logradouro: "${e.target.value}"`, 'info');
                });
                
                // Monitorar criação de sugestões
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeType === 1 && node.classList && node.classList.contains('address-suggestions')) {
                                addLog('Sugestões criadas', 'success');
                                
                                // Monitorar cliques nas sugestões
                                const suggestions = node.querySelectorAll('.address-suggestion');
                                addLog(`${suggestions.length} sugestões encontradas`, 'info');
                                
                                suggestions.forEach((suggestion, index) => {
                                    suggestion.addEventListener('click', function() {
                                        addLog(`Sugestão ${index + 1} clicada: "${suggestion.textContent}"`, 'success');
                                    });
                                });
                            }
                        });
                        
                        mutation.removedNodes.forEach(function(node) {
                            if (node.nodeType === 1 && node.classList && node.classList.contains('address-suggestions')) {
                                addLog('Sugestões removidas', 'info');
                            }
                        });
                    });
                });
                
                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
            }
        });
    </script>
</body>
</html>