<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Final - Busca de Endereços</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-md mx-auto bg-white rounded-lg shadow p-6">
        <h1 class="text-2xl font-bold mb-4">Teste Final - Busca de Endereços</h1>
        
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">Digite um endereço (mínimo 3 caracteres)</label>
            <input type="text" id="endereco" name="endereco" 
                   data-address-search="true"
                   placeholder="Ex: Rua Augusta, Avenida Paulista..." 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div class="mb-4">
            <button id="testar" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Testar Busca Direta
            </button>
        </div>
        
        <div id="resultado" class="mt-4 p-3 bg-gray-50 rounded min-h-20">
            <h3 class="font-semibold mb-2">Resultado:</h3>
            <div id="resultado-content">Digite algo no campo acima...</div>
        </div>
        
        <div id="logs" class="mt-4 p-3 bg-black text-green-400 rounded text-xs font-mono max-h-40 overflow-y-auto">
            <h3 class="text-white font-semibold mb-2">Logs:</h3>
            <div id="logs-content"></div>
        </div>
    </div>

    <script src="js/address-search.js"></script>
    
    <script>
        const logsContent = document.getElementById('logs-content');
        const resultadoContent = document.getElementById('resultado-content');
        const enderecoInput = document.getElementById('endereco');
        const testarBtn = document.getElementById('testar');
        
        // Capturar logs
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ': ' + args.join(' ');
            logsContent.appendChild(div);
            logsContent.scrollTop = logsContent.scrollHeight;
        };
        
        // Aguardar inicialização
        setTimeout(() => {
            console.log('=== TESTE INICIADO ==>');
            console.log('AddressSearch disponível:', typeof window.AddressSearch);
            console.log('Instância criada:', typeof window.addressSearch);
            
            if (window.addressSearch) {
                console.log('API Key:', window.addressSearch.googleMapsApiKey ? 'OK' : 'FALTANDO');
                console.log('Uso mensal:', window.addressSearch.monthlyUsage);
                
                // Teste direto
                testarBtn.addEventListener('click', async () => {
                    console.log('=== TESTE DIRETO ==>');
                    const query = enderecoInput.value || 'Rua Augusta';
                    console.log('Testando busca para:', query);
                    
                    try {
                        await window.addressSearch.searchByAddress(query, enderecoInput);
                        resultadoContent.innerHTML = 'Busca executada! Verifique os logs.';
                    } catch (error) {
                        console.error('Erro no teste:', error);
                        resultadoContent.innerHTML = 'Erro: ' + error.message;
                    }
                });
                
                // Monitorar input
                enderecoInput.addEventListener('input', (e) => {
                    console.log('Input detectado:', e.target.value);
                    resultadoContent.innerHTML = `Digitando: "${e.target.value}" (${e.target.value.length} chars)`;
                });
                
                console.log('Event listeners configurados!');
            } else {
                console.error('AddressSearch não foi inicializado!');
                resultadoContent.innerHTML = 'ERRO: AddressSearch não inicializado';
            }
        }, 3000);
    </script>
</body>
</html>